<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kattour Playground</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
</head>
<body class="bg-gray-900 text-gray-300 font-sans">

  <!-- Header -->
  <header x-data="{ open: false }" class="bg-gray-900/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-800">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center gap-3">
          <a href="index.html" class="flex items-center gap-3"><img src="assets/images/logo.png" alt="Kattour Logo" class="w-9 h-9" /><h1 class="text-2xl font-bold tracking-wide text-white">Kattour</h1></a>
        </div>
        <div class="hidden md:flex items-center space-x-6 text-sm font-medium">
          <a href="index.html" class="text-gray-300 hover:text-white transition">Home</a>
          <a href="docs.html" class="text-gray-300 hover:text-white transition">Docs</a>
          <a href="examples.html" class="text-gray-300 hover:text-white transition">Examples</a>
          <a href="modules.html" class="text-gray-300 hover:text-white transition">Modules</a>
          <a href="mobile.html" class="text-gray-300 hover:text-white transition">Mobile</a>
          <a href="playground.html" class="text-indigo-400 font-bold">Playground</a>
        </div>
        <div class="md:hidden"><button @click="open = !open" class="text-gray-300 hover:text-white focus:outline-none"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg></button></div>
      </div>
    </nav>
    <div x-show="open" @click.away="open = false" class="md:hidden"><div class="px-2 pt-2 pb-3 space-y-1 sm:px-3"><a href="index.html" class="block px-3 py-2 text-base font-medium">Home</a><a href="docs.html" class="block px-3 py-2 text-base font-medium">Docs</a><a href="examples.html" class="block px-3 py-2 text-base font-medium">Examples</a><a href="modules.html" class="block px-3 py-2 text-base font-medium">Modules</a><a href="mobile.html" class="block px-3 py-2 text-base font-medium">Mobile</a><a href="playground.html" class="block px-3 py-2 text-base font-medium text-indigo-400">Playground</a></div></div>
  </header>
  
  <main class="p-4 sm:p-8">
    <div class="text-center mb-8">
        <h2 class="text-4xl font-extrabold text-white">ðŸ§ª Kattour Playground</h2>
        <p class="mt-4 text-lg text-gray-400">Build UI in real-time. Any valid Kattour code from our docs will work here.</p>
    </div>

    <div class="grid lg:grid-cols-2 gap-8">
        <div>
            <div class="flex justify-between items-center mb-2">
                <label for="editor" class="block text-sm font-medium text-white">Kattour Code Editor</label>
                <select id="example-selector" class="bg-gray-700 text-white text-xs rounded-md border-gray-600 focus:ring-indigo-500">
                    <option value="profileCard">Load: Profile Card</option>
                    <option value="feedCard">Load: Feed Card</option>
                    <option value="loginForm">Load: Login Form</option>
                </select>
            </div>
            <textarea id="editor" class="w-full h-[32rem] p-4 border border-gray-700 rounded-lg font-mono bg-gray-900 text-gray-200 focus:ring-2 focus:ring-indigo-500 focus:outline-none"></textarea>
            <div class="flex gap-2 mt-4">
                <button onclick="compile()" class="w-full bg-indigo-600 text-white px-4 py-2.5 rounded-lg font-semibold hover:bg-indigo-500 transition">Run</button>
                <button onclick="clearEditor()" class="w-1/3 bg-gray-600 text-white px-4 py-2.5 rounded-lg font-semibold hover:bg-gray-500 transition">Clear</button>
            </div>
        </div>

        <div class="mt-6 lg:mt-0">
            <label class="block text-sm font-medium text-white mb-2">Live Preview</label>
            <div id="output" class="h-full min-h-[32rem] space-y-4 bg-gray-800 p-6 rounded-lg border border-gray-700 overflow-auto"></div>
        </div>
    </div>
  </main>
  
  <footer class="text-center text-sm text-gray-500 py-6 border-t border-gray-800 mt-10">
    Â© 2025 Kattour Language.
  </footer>

  <script>
    const examples = {
        profileCard: `module: Card
type: 'user-profile'
data:
  avatar: 'https://avatars.githubusercontent.com/u/16886253?v=4'
  name: 'Elias Kattour'
  handle: '@eliaskatt'
  title: 'Lead Developer @ Kattour.dev'
actions:
  - text: 'Follow'
    style: 'primary'
  - text: 'Message'
    style: 'secondary'`,
        feedCard: `module: Card
type: 'feed-item'
data:
  user:
    name: "Elias Kattour"
    avatar: "https://avatars.githubusercontent.com/u/16886253?v=4"
  content: "The playground now supports all modules from the docs!"
  actions: ["Like", "Comment", "Share"]`,
        loginForm: `module: Form
type: 'authentication-login'
fields:
  - name: 'email'
    label: 'Email Address'
  - name: 'password'
    label: 'Password'
actions:
  - text: 'Sign In'
    style: 'primary-full'`
    };

    const editor = document.getElementById('editor');
    const exampleSelector = document.getElementById('example-selector');

    function loadExample() {
        editor.value = examples[exampleSelector.value];
        compile();
    }

    function clearEditor() {
        editor.value = '';
        compile();
    }
    
    function renderComponent(component) {
        const type = Object.keys(component)[0];
        const data = component[type];

        switch (type) {
            case 'module':
                if (data.type === 'Card') return renderCardModule(data);
                if (data.type === 'Form') return renderFormModule(data);
                if (data.type === 'Alert') return renderAlertModule(data);
                return ``;
            // Add other simple components if needed, though most are modules now
            case 'text':
                return `<p class="text-gray-300">${data}</p>`;
            default:
                return '';
        }
    }

    function renderCardModule(data) {
        if (data.type === 'user-profile') {
            const actions = (data.actions || []).map(action => {
                const isPrimary = action.style === 'primary';
                const btnClass = isPrimary ? 'bg-indigo-500 hover:bg-indigo-400' : 'bg-gray-700 ring-1 ring-inset ring-gray-600 hover:bg-gray-600';
                return `<button class="rounded-md px-4 py-2 text-sm font-semibold text-white ${btnClass}">${action.text}</button>`;
            }).join('');

            return `<div class="bg-gray-900 p-8 rounded-lg flex justify-center"><div class="w-full max-w-sm text-center bg-gray-800 border border-gray-700 rounded-lg p-6"><img class="w-24 h-24 rounded-full mx-auto ring-4 ring-indigo-500/50" src="${data.data.avatar}" alt="User Avatar"><div class="mt-4"><h3 class="text-xl font-bold text-white">${data.data.name}</h3><p class="text-sm text-indigo-400">${data.data.handle}</p><p class="mt-2 text-sm text-gray-400">${data.data.title}</p></div><div class="mt-6 flex gap-4 justify-center">${actions}</div></div></div>`;
        }
        if (data.type === 'feed-item') {
            const actions = (data.data.actions || []).map(action => `<button class="flex items-center gap-1.5 text-sm text-gray-400 hover:text-white">${action}</button>`).join('');
            return `<div class="bg-gray-900/50 p-4 rounded-lg max-w-sm mx-auto w-full"><div class="flex items-center gap-3"><img class="h-10 w-10 rounded-full" src="${data.data.user?.avatar}" alt="User Avatar"><div><p class="font-semibold text-white">${data.data.user?.name}</p><p class="text-xs text-gray-400">Just now</p></div></div><p class="mt-4 text-gray-300">${data.data.content}</p><div class="mt-4 pt-3 border-t border-gray-700 flex justify-around">${actions}</div></div>`;
        }
        return '';
    }

    function renderFormModule(data) {
        if (data.type === 'authentication-login') {
            const fields = (data.fields || []).map(field => `<div><label class="block text-sm font-medium text-gray-300">${field.label}</label><input type="${field.name.includes('password') ? 'password' : 'email'}" class="mt-2 block w-full rounded-md border-0 bg-white/5 py-2 px-3 text-white ring-1 ring-inset ring-white/10 focus:ring-indigo-500"></div>`).join('');
            const actions = (data.actions || []).map(action => `<button type="submit" class="flex w-full justify-center rounded-md bg-indigo-500 px-3 py-2 text-sm font-semibold text-white hover:bg-indigo-400">${action.text}</button>`).join('');
            return `<div class="bg-gray-900 p-8 rounded-lg flex justify-center"><div class="w-full max-w-sm"><h3 class="text-2xl font-bold text-center text-white">Sign in</h3><form class="mt-8 space-y-6">${fields}${actions}</form></div></div>`;
        }
        return '';
    }
    
    function renderAlertModule(data) {
         // A simplified version for the playground
         return `<div class="w-full rounded-md bg-green-500/20 p-3 text-sm text-green-300 border border-green-500/50">${data.title}</div>`;
    }

    function compile() {
        try {
            const code = editor.value;
            if (!code.trim()) {
                document.getElementById('output').innerHTML = '<p class="text-gray-500">Editor is empty. Type some code or load an example.</p>';
                return;
            }

            // Pre-process to ensure it's a list for js-yaml
            let processedCode = code.trim();
            if (!processedCode.startsWith('-')) {
                processedCode = processedCode.replace(/^(\w+:)/gm, '- $1');
            }
            
            const parsed = jsyaml.load(processedCode);

            if (!Array.isArray(parsed)) {
                throw new Error("Kattour code must be a list of components (each component starts with a '-').");
            }
            
            const html = parsed.map(component => renderComponent(component)).join('');
            document.getElementById('output').innerHTML = html || `<p class="text-yellow-400">No components rendered. Check your syntax.</p>`;
        } catch (error) {
            document.getElementById('output').innerHTML = `<div class="text-red-400 font-mono text-sm"><p class="font-bold mb-2">Parsing Error:</p><pre>${error.message.split('\n')[0]}</pre></div>`;
        }
    }

    editor.addEventListener('input', compile);
    exampleSelector.addEventListener('change', loadExample);
    document.addEventListener('DOMContentLoaded', loadExample);

  </script>
</body>
</html>
