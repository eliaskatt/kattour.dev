<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kattour Playground</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-900 text-gray-300 font-sans">

  <!-- Header -->
  <header x-data="{ open: false }" class="bg-gray-900/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-800">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center gap-3">
          <a href="index.html" class="flex items-center gap-3">
            <img src="assets/images/logo.png" alt="Kattour Logo" class="w-9 h-9" />
            <h1 class="text-2xl font-bold tracking-wide text-white">Kattour</h1>
          </a>
        </div>
        <div class="hidden md:flex items-center space-x-6 text-sm font-medium">
          <a href="index.html" class="text-gray-300 hover:text-white transition">Home</a>
          <a href="docs.html" class="text-gray-300 hover:text-white transition">Docs</a>
          <a href="examples.html" class="text-gray-300 hover:text-white transition">Examples</a>
          <a href="modules.html" class="text-gray-300 hover:text-white transition">Modules</a>
          <a href="mobile.html" class="text-gray-300 hover:text-white transition">Mobile</a>
          <a href="playground.html" class="text-indigo-400 font-bold">Playground</a>
        </div>
        <div class="md:hidden">
          <button @click="open = !open" class="text-gray-300 hover:text-white focus:outline-none">
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
          </button>
        </div>
      </div>
    </nav>
    <!-- Mobile Menu -->
    <div x-show="open" @click.away="open = false" class="md:hidden"><div class="px-2 pt-2 pb-3 space-y-1 sm:px-3"><a href="index.html" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Home</a><a href="docs.html" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Docs</a><a href="examples.html" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Examples</a><a href="modules.html" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Modules</a><a href="mobile.html" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Mobile</a><a href="playground.html" class="text-indigo-400 block px-3 py-2 rounded-md text-base font-bold">Playground</a></div></div>
  </header>
  
  <main class="p-4 sm:p-8">
    <div class="text-center mb-8">
        <h2 class="text-4xl font-extrabold text-white">ðŸ§ª Kattour Playground</h2>
        <p class="mt-4 text-lg text-gray-400">Write Kattour code and see the result instantly update below.</p>
    </div>

    <div class="grid lg:grid-cols-2 gap-8">
        <div>
            <label for="editor" class="block text-sm font-medium text-white mb-2">Kattour Code Editor</label>
            <textarea id="editor" class="w-full h-[32rem] p-4 border border-gray-700 rounded-lg font-mono bg-gray-900 text-gray-200 focus:ring-2 focus:ring-indigo-500 focus:outline-none">card:
  type: 'feed-item'
  user:
    name: "Elias Kattour"
    avatar: "https://avatars.githubusercontent.com/u/16886253?v=4"
  content: "Excited to release the new Kattour UI modules! The playground now supports complex components."
  actions: ["Like", "Comment", "Share"]

text:
  content: "---"
  style: "muted"

button:
  label: "Load More"
  style: "secondary"</textarea>
            <button onclick="compile()" class="mt-4 w-full bg-indigo-600 text-white px-4 py-2.5 rounded-lg font-semibold hover:bg-indigo-500 transition">Run</button>
        </div>

        <div class="mt-6 lg:mt-0">
            <label class="block text-sm font-medium text-white mb-2">Live Preview</label>
            <div id="output" class="h-full min-h-[32rem] space-y-4 bg-gray-800 p-6 rounded-lg border border-gray-700 overflow-auto">
                <!-- Compiled HTML will be injected here -->
            </div>
        </div>
    </div>
  </main>
  
  <footer class="text-center text-sm text-gray-500 py-6 border-t border-gray-800 mt-10">
    Â© 2025 Kattour Language.
  </footer>

  <script>
    // --- ADVANCED PARSER & RENDERER ---
    function compile() {
        try {
            const code = document.getElementById('editor').value;
            let html = '';

            const blocks = code.split(/(?=^\w+:)/m).filter(s => s.trim() !== '');

            blocks.forEach(block => {
                const trimmedBlock = block.trim();
                const componentType = trimmedBlock.split(':')[0];

                switch(componentType) {
                    case 'card':
                        html += parseCard(trimmedBlock);
                        break;
                    case 'text':
                        html += parseText(trimmedBlock);
                        break;
                    case 'button':
                        html += parseButton(trimmedBlock);
                        break;
                    case 'input':
                        html += parseInput(trimmedBlock);
                        break;
                    // Add other top-level components here
                }
            });

            document.getElementById('output').innerHTML = html || '<p class="text-yellow-400">No valid elements to render. Try defining a component.</p>';

        } catch (error) {
            document.getElementById('output').innerHTML = `<p class="text-red-500">An error occurred: ${error.message}</p>`;
            console.error("Compilation Error:", error);
        }
    }

    function getValue(block, key) {
        const regex = new RegExp(`${key}:\\s*"([^"]*)"`);
        const match = block.match(regex);
        return match ? match[1] : null;
    }
    
    function getNestedValue(block, parent, key) {
        const nestedBlockRegex = new RegExp(`${parent}:\\s*\\n([^]*?)(?=\\n\\w|$)`);
        const nestedBlockMatch = block.match(nestedBlockRegex);
        if (nestedBlockMatch) {
            return getValue(nestedBlockMatch[1], key);
        }
        return null;
    }

    function getList(block, key) {
        const regex = new RegExp(`${key}:\\s*\\[([^\\]]*)\\]`);
        const match = block.match(regex);
        if (match && match[1]) {
            return match[1].split(',').map(item => item.trim().replace(/"/g, ''));
        }
        return [];
    }

    function parseCard(block) {
        const type = getValue(block, 'type');
        if (type === "'feed-item'") {
            const userName = getNestedValue(block, 'user', 'name');
            const userAvatar = getNestedValue(block, 'user', 'avatar') || 'https://i.pravatar.cc/48';
            const content = getValue(block, 'content');
            const actions = getList(block, 'actions');

            let actionButtons = '';
            if (actions.length) {
                actionButtons = actions.map(action => `<button class="flex items-center gap-1.5 text-sm text-gray-400 hover:text-white">${action}</button>`).join('');
            }
            
            return `
                <div class="bg-gray-900/50 p-4 rounded-lg max-w-sm mx-auto w-full">
                  <div class="flex items-center gap-3">
                    <img class="h-10 w-10 rounded-full" src="${userAvatar}" alt="User Avatar">
                    <div>
                      <p class="font-semibold text-white">${userName || 'Anonymous'}</p>
                      <p class="text-xs text-gray-400">Just now</p>
                    </div>
                  </div>
                  <p class="mt-4 text-gray-300">${content || ''}</p>
                  <div class="mt-4 pt-3 border-t border-gray-700 flex justify-around">
                    ${actionButtons}
                  </div>
                </div>
            `;
        }
        return '<p class="text-red-400">Unknown card type.</p>';
    }

    function parseText(block) {
        const content = getValue(block, 'content');
        const style = getValue(block, 'style');
        let styleClass = 'text-gray-300 text-base';
        if (style === 'heading') styleClass = 'text-2xl font-bold text-white';
        else if (style === 'subheading') styleClass = 'text-lg text-gray-400';
        else if (style === 'muted') styleClass = 'text-sm text-center text-gray-600';
        return `<p class="${styleClass}">${content}</p>`;
    }

    function parseButton(block) {
        const label = getValue(block, 'label');
        const style = getValue(block, 'style');
        let styleClass = 'bg-indigo-600 hover:bg-indigo-500';
        if (style === 'secondary') styleClass = 'bg-gray-700 hover:bg-gray-600';
        return `<button class="w-full ${styleClass} text-white px-4 py-2 rounded-lg font-semibold transition">${label}</button>`;
    }
    
    function parseInput(block) {
         const placeholder = getValue(block, 'placeholder');
         const label = getValue(block, 'label');
         let inputHtml = '';
         if (label) {
             inputHtml += `<label class="block text-sm font-medium text-white">${label}</label>`;
         }
         const marginTop = label ? 'mt-1' : 'mt-0';
         inputHtml += `<input placeholder="${placeholder || ''}" class="${marginTop} block w-full rounded-md border-0 bg-white/5 py-2 px-3 text-white ring-1 ring-inset ring-white/10 focus:ring-2 focus:ring-inset focus:ring-indigo-500">`;
         return `<div>${inputHtml}</div>`;
    }


    // Add event listener for real-time updates
    document.getElementById('editor').addEventListener('input', compile);
    // Initial compile on page load
    document.addEventListener('DOMContentLoaded', compile);
  </script>
</body>
</html>