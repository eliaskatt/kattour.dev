<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kattour Playground</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-900 text-gray-300 font-sans">

  <!-- Header -->
  <header x-data="{ open: false }" class="bg-gray-900/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-800">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center gap-3">
          <a href="index.html" class="flex items-center gap-3">
            <img src="assets/images/logo.png" alt="Kattour Logo" class="w-9 h-9" />
            <h1 class="text-2xl font-bold tracking-wide text-white">Kattour</h1>
          </a>
        </div>
        <div class="hidden md:flex items-center space-x-6 text-sm font-medium">
          <a href="index.html" class="text-gray-300 hover:text-white transition">Home</a>
          <a href="docs.html" class="text-gray-300 hover:text-white transition">Docs</a>
          <a href="examples.html" class="text-gray-300 hover:text-white transition">Examples</a>
          <a href="modules.html" class="text-gray-300 hover:text-white transition">Modules</a>
          <a href="mobile.html" class="text-gray-300 hover:text-white transition">Mobile</a>
          <a href="playground.html" class="text-indigo-400 font-bold">Playground</a>
        </div>
        <div class="md:hidden">
          <button @click="open = !open" class="text-gray-300 hover:text-white focus:outline-none">
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
          </button>
        </div>
      </div>
    </nav>
    <div x-show="open" @click.away="open = false" class="md:hidden"><div class="px-2 pt-2 pb-3 space-y-1 sm:px-3"><a href="index.html" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2">Home</a><a href="docs.html" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2">Docs</a><a href="examples.html" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2">Examples</a><a href="modules.html" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2">Modules</a><a href="mobile.html" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2">Mobile</a><a href="playground.html" class="text-indigo-400 font-bold block px-3 py-2">Playground</a></div></div>
  </header>
  
  <main class="p-4 sm:p-8">
    <div class="text-center mb-8">
        <h2 class="text-4xl font-extrabold text-white">ðŸ§ª Kattour Playground</h2>
        <p class="mt-4 text-lg text-gray-400">Build UI in real-time with our smart editor.</p>
    </div>

    <div class="grid lg:grid-cols-2 gap-8">
        <div>
            <div class="flex justify-between items-center mb-2">
                <label for="editor" class="block text-sm font-medium text-white">Kattour Code Editor</label>
                <select id="example-selector" class="bg-gray-700 text-white text-xs rounded-md border-gray-600 focus:ring-indigo-500">
                    <option value="feedCard">Load Example: Feed Card</option>
                    <option value="loginForm">Load Example: Login Form</option>
                    <option value="stats">Load Example: Stats Group</option>
                </select>
            </div>
            <textarea id="editor" class="w-full h-[32rem] p-4 border border-gray-700 rounded-lg font-mono bg-gray-900 text-gray-200 focus:ring-2 focus:ring-indigo-500 focus:outline-none"></textarea>
            <div class="flex gap-2 mt-4">
                <button onclick="compile()" class="w-full bg-indigo-600 text-white px-4 py-2.5 rounded-lg font-semibold hover:bg-indigo-500 transition">Run</button>
                <button onclick="clearEditor()" class="w-1/3 bg-gray-600 text-white px-4 py-2.5 rounded-lg font-semibold hover:bg-gray-500 transition">Clear</button>
            </div>
        </div>

        <div class="mt-6 lg:mt-0">
            <label class="block text-sm font-medium text-white mb-2">Live Preview</label>
            <div id="output" class="h-full min-h-[32rem] space-y-4 bg-gray-800 p-6 rounded-lg border border-gray-700 overflow-auto">
            </div>
        </div>
    </div>
  </main>
  
  <footer class="text-center text-sm text-gray-500 py-6 border-t border-gray-800 mt-10">
    Â© 2025 Kattour Language.
  </footer>

  <script>
    const examples = {
        feedCard: `card:
  type: 'feed-item'
  user:
    name: "Elias Kattour"
    avatar: "https://avatars.githubusercontent.com/u/16886253?v=4"
  content: "Excited to release the new Kattour UI modules! The playground now supports complex components."
  actions: ["Like", "Comment", "Share"]

text: "A simple line of text."
button: "A simple button"`,
        loginForm: `text:
  content: "Log In"
  style: "heading"

input:
  label: "Email Address"
  placeholder: "you@example.com"

input:
  label: "Password"
  type: "password"

button:
  label: "Sign In"`,
        stats: `grid:
  cols: 3
  items:
    - stat:
        label: "Revenue"
        value: "$12,500"
    - stat:
        label: "Users"
        value: "1,200"
        trend: "+5.4%"
    - stat:
        label: "Uptime"
        value: "99.9%"
`
    };

    const editor = document.getElementById('editor');
    const exampleSelector = document.getElementById('example-selector');

    function loadExample() {
        editor.value = examples[exampleSelector.value];
        compile();
    }

    function clearEditor() {
        editor.value = '';
        compile();
    }

    exampleSelector.addEventListener('change', loadExample);

    function parseKattour(text) {
        const lines = text.split('\n').filter(line => line.trim().length > 0 || line.length > 0);
        const result = [];
        const stack = [{ obj: result, indent: -1, isArray: true }];

        lines.forEach(line => {
            if (line.trim().length === 0) return;

            const indent = line.search(/\S|$/);
            const content = line.trim();
            
            while (indent <= stack[stack.length - 1].indent) {
                stack.pop();
            }
            
            const parent = stack[stack.length - 1].obj;
            const [keyWithDash, ...valueParts] = content.split(':');
            const value = valueParts.join(':').trim().replace(/^(["'])(.*)\1$/, '$2');
            const key = keyWithDash.trim().replace(/^- /, '');
            const isListItem = content.startsWith('-');

            let currentObj;

            if (value) {
                currentObj = { [key]: value };
            } else {
                currentObj = { [key]: {} };
            }

            if (Array.isArray(parent)) {
                parent.push(currentObj);
            } else {
                if (!parent[key]) {
                    parent[key] = isListItem ? [] : {};
                }
                
                if(isListItem) {
                    const newObj = value ? value : {};
                    parent[key].push(newObj);
                    currentObj = newObj;
                } else {
                    if (value) {
                        parent[key] = value;
                    } else {
                       parent[key] = {};
                       currentObj = parent[key];
                    }
                }
            }
            
            if (!value) {
                stack.push({ obj: Object.values(currentObj)[0], indent });
            }
        });

        // Simple merge for top-level keys
        const merged = {};
        result.forEach(item => {
            const key = Object.keys(item)[0];
            if (merged[key]) {
                if (!Array.isArray(merged[key])) merged[key] = [merged[key]];
                merged[key].push(item[key]);
            } else {
                merged[key] = item[key];
            }
        });

        return merged;
    }

    // --- Renderer ---
    function render(parsed) {
        let html = '';
        for (const key in parsed) {
            const data = parsed[key];
            if (Array.isArray(data)) {
                 data.forEach(item => html += renderComponent(key, item));
            } else {
                html += renderComponent(key, data);
            }
        }
        return html;
    }

    function renderComponent(type, data) {
        switch (type) {
            case 'card':
                if (data.type === 'feed-item') {
                    const actions = data.actions.replace(/[\[\]"]/g, '').split(',').map(a => a.trim());
                    const actionButtons = actions.map(action => `<button class="flex items-center gap-1.5 text-sm text-gray-400 hover:text-white">${action}</button>`).join('');
                    return `<div class="bg-gray-900/50 p-4 rounded-lg max-w-sm mx-auto w-full"><div class="flex items-center gap-3"><img class="h-10 w-10 rounded-full" src="${data.user.avatar}" alt="User Avatar"><div><p class="font-semibold text-white">${data.user.name}</p><p class="text-xs text-gray-400">Just now</p></div></div><p class="mt-4 text-gray-300">${data.content}</p><div class="mt-4 pt-3 border-t border-gray-700 flex justify-around">${actionButtons}</div></div>`;
                } return '';
            case 'text':
                const content = typeof data === 'string' ? data : data.content;
                let textClass = 'text-gray-300';
                if (data.style === 'heading') textClass = 'text-2xl font-bold text-white';
                if (data.style === 'muted') textClass = 'text-sm text-center text-gray-600';
                return `<p class="${textClass}">${content}</p>`;
            case 'button':
                const label = typeof data === 'string' ? data : data.label;
                let btnClass = 'bg-indigo-600 hover:bg-indigo-500';
                if (data.style === 'secondary') btnClass = 'bg-gray-700 hover:bg-gray-600';
                return `<button class="${btnClass} w-full text-white px-4 py-2 rounded-lg font-semibold">${label}</button>`;
            case 'input':
                let inputHtml = `<div>`;
                if(data.label) inputHtml += `<label class="block text-sm font-medium text-white">${data.label}</label>`;
                const marginTop = data.label ? 'mt-1' : 'mt-0';
                inputHtml += `<input type="${data.type || 'text'}" placeholder="${data.placeholder || ''}" class="${marginTop} block w-full rounded-md border-0 bg-white/5 py-2 px-3 text-white ring-1 ring-inset ring-white/10 focus:ring-indigo-500">`;
                inputHtml += `</div>`;
                return inputHtml;
            case 'grid':
                let gridHtml = `<div class="grid grid-cols-${data.cols || 1} gap-4">`;
                if(Array.isArray(data.items)) {
                    data.items.forEach(item => { for(const key in item) { gridHtml += renderComponent(key, item[key]); } });
                }
                gridHtml += `</div>`;
                return gridHtml;
            case 'stat':
                 let trendHtml = data.trend ? `<p class="text-xs ${data.trend.startsWith('+') ? 'text-green-400' : 'text-red-400'}">${data.trend}</p>` : '';
                 return `<div class="bg-gray-800 p-4 rounded-lg text-center"><p class="text-sm font-medium text-gray-400">${data.label}</p><p class="text-2xl font-bold text-white">${data.value}</p>${trendHtml}</div>`;
            default:
                return '';
        }
    }

    function compile() {
        try {
            const code = editor.value;
            if (!code.trim()) {
                document.getElementById('output').innerHTML = '<p class="text-gray-500">Editor is empty. Type some code or load an example.</p>';
                return;
            }
            const parsedObject = parseKattour(code);
            const html = render(parsedObject);
            document.getElementById('output').innerHTML = html;
        } catch (error) {
            document.getElementById('output').innerHTML = `<p class="text-red-500 font-mono">Parsing Error: ${error.message}</p>`;
            console.error("Compilation Error:", error);
        }
    }

    editor.addEventListener('input', compile);
    document.addEventListener('DOMContentLoaded', loadExample);

  </script>
</body>
</html>
